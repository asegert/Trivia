var Trivia=Trivia||{};Trivia.GameState={init:function(){this.allData=JSON.parse(this.game.cache.getText("queryData")),this.background=this.add.sprite(0+Trivia.offsetX,0+Trivia.offsetY,"background"),this.threeLevels=this.add.sprite(660+Trivia.offsetX,570+Trivia.offsetY,"threeLevels"),this.threeLevels.anchor.setTo(.5,.5),this.threeLevels.scale.setTo(.5,.5),this.threeLevels.alpha=0,this.add.tween(this.threeLevels.scale).to({x:1,y:1},2e3,Phaser.Easing.Linear.None,!0,0,-1),this.add.tween(this.threeLevels).to({alpha:1},2e3,Phaser.Easing.Linear.None,!0,0,-1),this.currQuestion=-1,this.progress=0,this.secondChances=[],this.currLevel=0,this.numAnswered=0,this.games=this.add.group(),this.lightning=this.add.group(),this.shuffled,this.gameIndex,this.coupons=["coupon1","coupon2","coupon3"],this.display=["level1","level2","level3"],this.overlay=["overlay1","overlay2","overlay3"],this.rotate=!0},create:function(){this.createMain()},createMain:function(){for(var e=150,t=0;t<this.allData.games.length;t++){var s=this.add.sprite(e-50+Trivia.offsetX,240+Trivia.offsetY,"lightning");s.scale.setTo(.5,.5),s.scale.y*=-1,s.anchor.setTo(.1,.1),this.lightning.add(s);var i=this.add.sprite(e-50+Trivia.offsetX,440+Trivia.offsetY,"lightning");i.scale.setTo(.5,.5),i.anchor.setTo(.1,.1),this.lightning.add(i);var a=this.add.button(e+Trivia.offsetX,350+Trivia.offsetY,"spinBox",function(e){Trivia.music.stop(),Trivia.music=this.add.audio(this.allData.games[e.gameIndex].theme),Trivia.music.play(),this.gameIndex=e.gameIndex,this.shuffled=this.shuffleData(),this.currQuestion++,this.currLevel=0,this.games.removeAll(),this.lightning.removeAll(),this.newLevel()},this);a.anchor.setTo(.5,.5),a.gameIndex=t;a.animations.add("open");a.animations.play("open",16,!0),this.games.add(a);var h=this.add.button(e+Trivia.offsetX,350+Trivia.offsetY,this.allData.games[t].label,function(e){Trivia.music.stop(),Trivia.music=this.add.audio(this.allData.games[e.gameIndex].theme),Trivia.music.play(),this.gameIndex=e.gameIndex,this.shuffled=this.shuffleData(),this.currQuestion++,this.currLevel=0,this.games.removeAll(),this.lightning.removeAll(),this.newLevel()},this);h.scale.setTo(.5,.5),h.anchor.setTo(.5,.5),h.gameIndex=t,h.alpha=0,h.angle-=15;this.add.tween(h).to({alpha:1},2e3,Phaser.Easing.Linear.None,!0,0,-1);this.games.add(h),e+=310}this.world.bringToTop(this.games);this.time.events.loop(.1*Phaser.Timer.SECOND,function(){this.lightning.forEach(function(e){this.time.events.add(Phaser.Timer.SECOND*Math.random(),function(){e.alpha=0,this.time.events.add(Phaser.Timer.SECOND*Math.random(),function(){e.alpha=1},this)},this)},this)},this)},createQuestion:function(){this.gameOverlay=this.add.sprite(0+Trivia.offsetX,0+Trivia.offsetY,this.overlay[this.currLevel]),this.hint=this.add.button(50+Trivia.offsetX,50+Trivia.offsetY,"hint",function(){!this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].answer[0]&&this.answer1.alive?this.answer1.destroy():!this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].answer[1]&&this.answer2.alive?this.answer2.destroy():!this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].answer[2]&&this.answer3.alive?this.answer3.destroy():!this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].answer[3]&&this.answer4.alive&&this.answer4.destroy()},this),this.hint.scale.setTo(.7,.7);var e={fill:"#FFFFFF",stroke:"#000000",strokeThickness:4};this.query=this.add.text(350+Trivia.offsetX,this.allData.games[this.gameIndex].query+Trivia.offsetY,this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].question,e),this.answer1=this.add.text(400+Trivia.offsetX,this.allData.games[this.gameIndex].answer+Trivia.offsetY,"A: "+this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].availAns[0],e),this.answer1.inputEnabled=!0,this.answer1.events.onInputDown.add(function(){this.answered(this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].answer[0]),this.answer1.inputEnabled=!1,this.answer2.inputEnabled=!1,this.answer3.inputEnabled=!1,this.answer4.inputEnabled=!1},this),this.answer2=this.add.text(400+Trivia.offsetX,this.allData.games[this.gameIndex].answer+50+Trivia.offsetY,"B: "+this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].availAns[1],e),this.answer2.inputEnabled=!0,this.answer2.events.onInputDown.add(function(){this.answered(this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].answer[1]),this.answer1.inputEnabled=!1,this.answer2.inputEnabled=!1,this.answer3.inputEnabled=!1,this.answer4.inputEnabled=!1},this),this.answer3=this.add.text(400+Trivia.offsetX,this.allData.games[this.gameIndex].answer+100+Trivia.offsetY,"C: "+this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].availAns[2],e),this.answer3.inputEnabled=!0,this.answer3.events.onInputDown.add(function(){this.answered(this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].answer[2]),this.answer1.inputEnabled=!1,this.answer2.inputEnabled=!1,this.answer3.inputEnabled=!1,this.answer4.inputEnabled=!1},this),this.answer4=this.add.text(400+Trivia.offsetX,this.allData.games[this.gameIndex].answer+150+Trivia.offsetY,"D: "+this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].availAns[3],e),this.answer4.inputEnabled=!0,this.answer4.events.onInputDown.add(function(){this.answered(this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].answer[3]),this.answer1.inputEnabled=!1,this.answer2.inputEnabled=!1,this.answer3.inputEnabled=!1,this.answer4.inputEnabled=!1},this)},answered:function(e){if(e)this.score++,Trivia.music.volume=.3,(t=this.add.audio(this.allData.games[this.gameIndex].right)).play();else{Trivia.music.volume=.3;var t=this.add.audio(this.allData.games[this.gameIndex].wrong);t.play()}t.onStop.add(function(){Trivia.music.volume=1},this);for(var s=0;s<this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].answer.length;s++){var i="#FF0000";if(this.allData.games[this.gameIndex].levels[this.currLevel].queries[this.shuffled[this.currQuestion]].answer[s]&&(i="#22AA22"),0==s){a={fill:i,stroke:"#FFFFFF",strokeThickness:6};this.answer1.setStyle(a)}else if(1==s){a={fill:i,stroke:"#FFFFFF",strokeThickness:5};this.answer2.setStyle(a)}else if(2==s){a={fill:i,stroke:"#FFFFFF",strokeThickness:5};this.answer3.setStyle(a)}else if(3==s){var a={fill:i,stroke:"#FFFFFF",strokeThickness:5};this.answer4.setStyle(a)}}this.time.events.add(1.5*Phaser.Timer.SECOND,function(){this.query.destroy(),this.answer1.destroy(),this.answer2.destroy(),this.answer3.destroy(),this.answer4.destroy(),this.hint.destroy(),++this.currQuestion!=this.allData.games[this.gameIndex].levels[this.currLevel].queries.length?(this.gameOverlay.destroy(),this.createQuestion()):this.currLevel+1!=this.allData.games[this.gameIndex].levels.length?this.levelEnd():this.gameEnd()},this)},shuffleData:function(){for(var e=this.allData.games[this.gameIndex].levels[this.currLevel].queries.length,t=[],s=Object.assign({},this.allData.games[this.gameIndex].levels[this.currLevel].queries),i=0,a=0;a<e;a++){for(var h=Math.floor(Math.random()*(e-1));null===s[h]&&h<e;)h++;for(h>=e&&(h=0);null===s[h]&&h<e;)h++;t[i]=s[h].type,s[h]=null,i++}return t},reloadQueries:function(){this.queryList=this.secondChances,this.secondChances=[],this.currQuery=0,this.startQueries()},levelEnd:function(){this.endAnim(),this.time.events.add(6*Phaser.Timer.SECOND,function(){this.box.destroy(),this.coupon.destroy(),this.emitter.destroy(),this.emitter2.destroy(),this.rotate=!0,this.currLevel=this.currLevel+1,this.currLevel<3&&(this.shuffled=this.shuffleData()),this.currQuestion=0,this.newLevel()},this)},gameEnd:function(){this.endAnim(),this.time.events.add(6*Phaser.Timer.SECOND,function(){this.box.destroy(),this.coupon.destroy(),this.emitter.destroy(),this.emitter2.destroy(),this.rotate=!0,document.getElementById("form1").submit()},this)},endAnim:function(){var e=["precision mediump float;","uniform float     time;","uniform vec2     resolution;","#define PI 3.1415926535897932384626433832795","const float position = 0.0;","const float scale = 1.0;","const float intensity = 0.5;","float band(vec2 pos, float amplitude, float frequency) {","float wave = scale * amplitude * sin(1.0 * PI * frequency * pos.x + time) / 2.05;","float light = clamp(amplitude * frequency * 0.02, 0.001 + 0.001 / scale, 20.0) * scale / abs(wave - pos.y);","return light;","}","void main() {","vec3 color = vec3(0.24, 0.16, 0.45);","color = color == vec3(0.0)? vec3(0.45, 0.16, 0.24) : color;","vec2 pos = (gl_FragCoord.xy / resolution.xy);","pos.y += - 0.5;","float spectrum = 0.0;","const float lim = 5.0;","#define time time*0.037 + pos.x*10.","for(float i = 0.0; i < lim; i++){","spectrum += band(pos, 1.0*sin(time*0.1/PI), 1.0*sin(time*i/lim))/pow(lim, 0.25);","}","spectrum += band(pos, cos(10.7), 2.5);","spectrum += band(pos, 0.3, sin(2.0));","spectrum += band(pos, 0.05, 4.5);","spectrum += band(pos, 0.1, 7.0);","spectrum += band(pos, 0.1, 1.0);","gl_FragColor = vec4(color * spectrum, spectrum);","}"];this.filter=new Phaser.Filter(this,null,e),this.filter.setResolution(960,640),this.sprite=this.add.sprite(),this.sprite.width=960+Trivia.offsetY,this.sprite.height=640+Trivia.offsetX,this.sprite.filters=[this.filter],Trivia.music.volume=.3,this.add.audio("levelUp").play(),this.box=this.add.sprite(200+Trivia.offsetX,0+Trivia.offsetY,"unBox"),this.box.scale.setTo(.4,.4),this.add.tween(this.box).to({y:340},2e3,Phaser.Easing.Linear.None,!0),this.anim=this.box.animations.add("open"),this.time.events.add(Phaser.Timer.SECOND,function(){this.box.animations.play("open",20,!1),this.anim.onComplete.add(function(e){Trivia.music.volume=.3,this.add.audio("cheer").play(),this.coupon=this.add.sprite(e.x+Trivia.offsetX,400+Trivia.offsetY,this.coupons[this.currLevel]),this.coupon.x=e.x+this.coupon.texture.width/4+Trivia.offsetX,this.coupon.anchor.setTo(.5,.5),this.coupon.scale.setTo(.5,.5),this.coupon.alpha=0,this.preTween=this.add.tween(this.coupon).to({alpha:1,x:480+Trivia.offsetX,y:200+Trivia.offsetY},2e3,Phaser.Easing.Linear.None,!0),this.preTween.onComplete.add(function(){this.coupon.rotation=0,this.rotate=!1},this),this.tween=this.add.tween(this.coupon.scale).to({x:1,y:1},4e3,Phaser.Easing.Linear.None,!0),this.tween.onComplete.add(function(){this.emitter=this.add.emitter(this.coupon.x-this.coupon.texture.width/2+Trivia.offsetX,this.coupon.y-this.coupon.texture.height/2+Trivia.offsetY,2e3),this.emitter.makeParticles("confetti",[0,1,2,3,4,5]),this.emitter.setScale(2,2),this.emitter.start(!1,5e3,5),this.emitter2=this.add.emitter(this.coupon.x-this.coupon.texture.width/2+this.coupon.texture.width+Trivia.offsetX,this.coupon.y-this.coupon.texture.height/2+Trivia.offsetY,2e3),this.emitter2.makeParticles("confetti",[0,1,2,3,4,5]),this.emitter2.setScale(2,2),this.emitter2.start(!1,5e3,5)},this)},this)},this)},newLevel:function(){this.displayText=this.add.sprite(200+Trivia.offsetX,400+Trivia.offsetY,this.display[this.currLevel]),this.displayText.anchor.setTo(.5,.5),this.displayText.scale.setTo(.5,.5),this.displayText.alpha=0,this.add.tween(this.displayText).to({alpha:1,x:480+Trivia.offsetX,y:200+Trivia.offsetY},2e3,Phaser.Easing.Linear.None,!0),this.tween=this.add.tween(this.displayText.scale).to({x:1,y:1},2e3,Phaser.Easing.Linear.None,!0),this.tween.onComplete.add(function(){this.displayText.destroy(),void 0!=this.gameOverlay&&this.gameOverlay.destroy(),this.createQuestion()},this)},lightWave:function(){},update:function(){void 0!=this.filter&&this.filter.update(),void 0!=this.coupon&&this.rotate&&(this.coupon.rotation+=.5)}};